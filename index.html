<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Parallel Wave Function Collapse</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="8eb6f487-9dcb-48b6-8817-32c9a2a93683" class="page sans"><header><img class="page-cover-image" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/NTooBig.png" style="object-position:center 50%"/><h1 class="page-title">Parallel Wave Function Collapse</h1></header><div class="page-body"><blockquote id="efe9d928-dbaf-4106-919c-592f18cf03a3" class="">The Wave Function Collapse algorithm models the behavior of wave functions in quantum systems. A wave function represents a quantum system&#x27;s state by encompassing all possible finite states at once, known as &#x27;superposition.&#x27; The superposition collapses and converges to a single definite state only when an observation is made.</blockquote><p id="b9901e13-4979-4edc-9fb6-4b887b3f4248" class="">
</p><figure id="1ff4d75c-27ac-49e6-874b-8861890368f9" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled.png"><img style="width:219px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled.png"/></a></figure><h1 id="18e74ac3-0067-4442-8a20-8b2581bcb2b1" class=""><span style="border-bottom:0.05em solid">Goal</span></h1><p id="28bf6caa-bfa6-48a4-b466-23dde39dd337" class="">The Wave Function Collapse algorithm is widely known for its impressive capacity to simulate quantum systems. However, due to its significant computational demands, it is subject to input size restrictions and can cause extensive delays. To address these obstacles, our team seeks to enhance the algorithm&#x27;s performance by integrating parallelism to concurrently execute specific tasks.</p><h1 id="5ceac8de-0970-4cef-a3c8-d839e1b2f350" class=""><span style="border-bottom:0.05em solid">Components</span></h1><ol type="1" id="08f9c8a5-c4d1-4785-9f14-3d2bfc48bfa8" class="numbered-list" start="1"><li><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Image Processor</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></li></ol><ol type="1" id="541849e4-4660-4ccf-9953-df6386cfda4b" class="numbered-list" start="2"><li><strong><strong><strong><strong><strong><strong><strong><strong>WFC Core</strong></strong></strong></strong></strong></strong></strong></strong></li></ol><h1 id="644fa3ca-a705-4cf3-a208-d8d49e4f82d0" class=""><span style="border-bottom:0.05em solid"><strong>Image Processor</strong></span></h1><p id="c9a34105-670a-4164-9e06-a285ecb25532" class="">The Image Processor is a crucial part of our system that prepares images for use in the Wave Function Collapse algorithm. It helps generate important information like sample IDs and their relationships with neighboring samples. </p><p id="a1881414-bf07-4b77-975a-506a904dab7a" class="">This process involves three main steps: </p><ol type="1" id="258fac08-42d7-4a6a-ad27-0d1c74660ff2" class="numbered-list" start="1"><li>Collecting all <strong><strong><strong>NxN</strong></strong></strong> patterns</li></ol><ol type="1" id="c565d0e2-e3c6-4e21-8be4-ce9d40d75286" class="numbered-list" start="2"><li>Setting up frequency rules</li></ol><ol type="1" id="c6edec2f-c40d-41a1-a306-c221bb841bac" class="numbered-list" start="3"><li>Determining adjacency rules</li></ol><p id="e0456e0a-a246-43ef-a321-28c220f72086" class="">
</p><p id="e4bf27d4-02e5-4d3f-a946-fd34291a001d" class=""><span style="border-bottom:0.05em solid"><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Pattern/Sample Collection</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></span></p><p id="332eb211-160a-436b-a05a-fbc4a08db01a" class="">Collecting patterns is done by stepping over every possible pixel and grabbing all <strong><strong><strong>N-1</strong></strong></strong> pixels east-ward and south-ward, from this we get the raw patterns.</p><pre id="5a7d2da1-5513-4526-b8b3-6f5fa996bdf1" class="code"><code>// src/image_reader.rs
pub fn sample(&amp;self, n: i32) -&gt; Vec&lt;Sample&gt; { ... }</code></pre><figure id="3b25c1a5-2356-4d24-b896-64bf27356d27" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%201.png"><img style="width:944px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%201.png"/></a></figure><p id="c1ec38a9-dba9-40b8-a922-f1cbb5be8567" class=""><strong><span style="border-bottom:0.05em solid">Frequency Rule</span></strong></p><p id="72bef4c2-b1ca-4304-a6f1-e72623fa60a7" class="">Working with raw patterns can be problematic, which is why we need to remove duplicates. Luckily, this step serves a dual purpose as we can also keep track of the number of duplicates and use that information in our frequency rule. So, deduplication not only eliminates redundancy but also provides valuable information that we can leverage in the frequency rule.</p><pre id="2394117b-5d3c-4d0e-802c-d00e0160e8d7" class="code"><code>// src/model.rs
// Calculate the number of times each unique sample appears
let freq_map: HashMap&lt;Sample, i32&gt; = unprocessed_samples.iter().fold(
		HashMap::&lt;Sample, i32&gt;::new(),
		|mut freq_map, sample| {
				*freq_map.entry(sample.clone()).or_insert(0) += 1;
				freq_map
		},
);</code></pre><figure id="9f89a8f1-64a1-4bf0-be2d-11ea67c90cf7" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%202.png"><img style="width:726px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%202.png"/></a><figcaption>Notice how the two patterns on the left are the same. The frequency of this pattern will be 2.</figcaption></figure><p id="dd174fc9-bb34-4dd9-9520-31dba99c16a5" class=""><span style="border-bottom:0.05em solid"><strong>Adjacency Rule</strong></span></p><p id="6281f3d5-73a2-447e-aac4-aad043d23430" class="">The final step is generating the adjacency rules. To accomplish this, we compare each sample to all other samples, including itself, and check if their N-1 pixels in their respective direction match. For instance, we would check if the bottom N-1 pixels of sample A match the top N-1 pixels of sample B. By doing this for every sample, we are able to create the necessary adjacency rules.</p><pre id="9c8c5fd5-d5d3-43cc-9179-a8d795bec39f" class="code"><code>// src/model.rs
// Create adjacency rules
for s1 in 0..samples.len() {
    for s2 in 0..samples.len() {
        for direction in &amp;ALL_DIRECTIONS {
             if samples[s1].compatible(&amp;samples[s2], *direction) {
                adjacency_rules[s1][direction.to_idx()].insert(s2);
             }
        }
    }
}</code></pre><figure id="d5cc6dc0-67ea-4e58-a1dd-7ede1a7d2f60" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%203.png"><img style="width:538px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%203.png"/></a><figcaption>An image showing the left-right compatibility between two NxN patterns.</figcaption></figure><h1 id="2e70bfbd-2652-442f-9ffd-4a9cdfa154c2" class=""><span style="border-bottom:0.05em solid"><strong>WFC Core Overview</strong></span></h1><p id="77bd8437-640d-477a-a586-0b57da06eec5" class="">
</p><p id="b320ef59-e854-467b-ac46-1fb137d47997" class="">The core algorithm starts by creating a grid of cells, with each cell in a superposition state, meaning it can be any of the NxN patterns. This concept is similar to how a Sudoku puzzle starts, with each blank cell initially holding all possible numbers from 1-9. As you observe the neighbors in the same row, column, and box, the range of possibilities for each cell gets narrowed down. Eventually, you reach a point where only one number can fit in a particular cell, leading to convergence. Similarly, in the Wave Function Collapse algorithm, observing the neighbors&#x27; patterns gradually collapses the superposition state until a final configuration is achieved.</p><p id="e450178b-a07d-4122-ace7-48a471dd20f1" class="">
</p><p id="579b8342-707e-4731-98fb-b4ccb1c8bb98" class="">The Wave Function Collapse algorithm operates on a simple &quot;search and kill&quot; loop. Here is a high-level pseudo-code representation of the main loop:</p><pre id="dc0cdb1b-8448-4568-9a69-dbff1eb1933a" class="code"><code>while not_collapsed:
	// Choose the next cell with the lowest 
	// entropy which hasn&#x27;t been collapsed yet
	next_coord = find_cell_with_lowest_entropy()
	
	// Collapse the chosen cell
	collapse_cell_at(next_coord)
	
	// Propagate the effects
	propagate()
	remaining_uncollapsed_cells -= 1;
}</code></pre><h1 id="48a2dbae-4fb1-49c6-a851-bbc0ac0d91ed" class=""><span style="border-bottom:0.05em solid"><strong>Entropy</strong></span></h1><p id="92ff623c-829f-436a-bd19-e4c402f88830" class="">Entropy measures uncertainty, and it&#x27;s essential in the Wave Function Collapse algorithm. It refers to the number of possibilities that remain in a particular cell (frequency calculations are involved but omitted here). The higher the entropy, the more possibilities there are, and the greater the uncertainty.</p><p id="c2d94365-02f7-445c-90de-d5cf739092a2" class="">Knowing about entropy helps us choose which cell to collapse next for faster convergence. Collapsing cells with low entropy reduces the chance of encountering an impossible output, which happens when a cell has zero potential to be meaningful. Therefore, we need to be careful when selecting cells to collapse and avoid contradictions as they make the output invalid.</p><figure id="582f612c-d2ff-42f5-a4df-7ada17490770" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%204.png"><img style="width:430px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%204.png"/></a></figure><h1 id="7e0f8898-313e-45ee-8ee5-babced87782b" class=""><span style="border-bottom:0.05em solid"><strong>Cell Collapse</strong></span></h1><p id="f1b35601-fb74-46b6-ada0-6d4c8a90c98f" class="">Once a cell is selected for observation and collapse, we choose a compatible pattern with frequency hints in mind in a random manner. This ensures that the output characteristics of the Wave Function Collapse algorithm accurately reflect the input.</p><figure id="6d3e5ae4-8d48-4bf2-9aa0-65c5cd5183f2" class="image"><a href="https://media.tenor.com/Divac_WNv-AAAAAM/falling-drunk-man-falling.gif"><img style="width:144px" src="https://media.tenor.com/Divac_WNv-AAAAAM/falling-drunk-man-falling.gif"/></a></figure><h1 id="79cd3c2a-f002-46d8-b26b-0438c20a2ad7" class=""><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong>Propagation</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></h1><p id="a20ff9d9-3c61-42ea-9b14-84addfb8cd6a" class="">The propagation phase is where the algorithm&#x27;s complexity begins. During the propagation phase, the algorithm updates neighboring cells based on the removal of a specific possibility from the origin point. It&#x27;s like a 2D domino effect, where changes propagate like a wave throughout the grid. In other words, the removal of a possibility in one cell affects its neighboring cells and triggers further updates. </p><p id="c6060648-9807-406e-b567-927568119452" class="">The chaos is cranked to 11 because when a neighboring cell is updated and some patterns are no longer possible, it enqueues a new removal update, triggering another round of propagation. This process can escalate quickly, causing a chain reaction of updates and removals that can be difficult to predict.</p><figure id="c1739d1e-6c02-410f-bb91-058032b9f1cf" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%205.png"><img style="width:840px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%205.png"/></a></figure><p id="c8f1e60f-796c-4ee4-948f-1c09796db603" class="">
</p><h1 id="573f1d97-e12f-4d75-bbf5-d96df9de3a4a" class=""><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong>Parallelization</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></h1><p id="e421b727-a7c0-45c4-8fd5-6f44d96c09e3" class="">Initially, we had planned to parallelize the propagation process, but it proved to be too complicated. Instead, we decided to parallelize the collapse of subsections of the output. Our approach is straightforward: we forcefully collapse N-1 cells in the middle column and row of the grid, triggering propagation updates for the entire grid. We can then isolate and process each subsection of the grid, knowing the collapsed cells in between. This way, we can handle each subsection in parallel without worrying about the output&#x27;s seamlessness.</p><p id="1012664c-9d2e-4214-8833-562feb87e810" class="">One surprising advantage of this strategy is that it lowers the chance of contradiction, something which we only found out after the implementation, and it makes perfect sense in hindsight because each grid is much smaller meaning it has less overall entropy.</p><figure id="8b0570b0-9c8d-4179-93c2-1e9b932ebe2e" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%206.png"><img style="width:875px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%206.png"/></a></figure><h1 id="c3c24866-59c3-4f03-9140-b36ed56afa8a" class=""><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong>Contradiction, contradiction, contradiction!</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></h1><p id="3068fe27-6faa-45fd-add6-6cb26ba17397" class="">Contradiction is a common issue with the Wave Function Collapse algorithm and can be challenging to remedy. There are various techniques to recover from a contradiction, but they are beyond the scope of our project.</p><p id="1998d244-3468-44ed-b484-8aa7189cd396" class="">As this project is for a parallel computing class, we opted for a simple remedy of retrying in parallel. For each grid subsection, we assign four workers to compute their unique answers. We then select any successful result at random.</p><figure id="5c5ebeb0-e386-402f-b559-e2feb27b8978" class="image"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%207.png"><img style="width:600px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%207.png"/></a></figure><p id="023cc341-b534-4cb8-9461-fddb6a65f951" class="">
</p><h1 id="4a7f321e-1b05-485c-b83e-6af7a4b041af" class=""><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong><span style="border-bottom:0.05em solid"><strong>Extra</strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></strong></span></h1><p id="71a1903d-0b1a-4af8-ab2b-8e3991ee75bf" class="">Here is how N can affect the output.</p><figure id="dcd22652-352b-49a0-9afd-9746d7fd2ed0" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%208.png"><img style="width:336px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%208.png"/></a><figcaption>N = 6</figcaption></figure><figure id="918c697b-cac8-4c51-937f-2ddc60bef92f" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%209.png"><img style="width:336px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%209.png"/></a><figcaption>N = 3</figcaption></figure><figure id="18dbcca0-24e5-4a3e-957a-6e394923c7de" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2010.png"><img style="width:346px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2010.png"/></a><figcaption>N = 3</figcaption></figure><figure id="6198f5db-b03e-485a-b04d-d46905bfa52f" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2011.png"><img style="width:432px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2011.png"/></a><figcaption>N = 5</figcaption></figure><figure id="2d9e09fc-cd44-4a31-bfc5-abf35c06584f" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2012.png"><img style="width:543px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2012.png"/></a><figcaption>N = 3</figcaption></figure><figure id="a8aa6f85-46a9-4ec1-97b9-a80191e272c5" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2013.png"><img style="width:538px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2013.png"/></a><figcaption>N = 2</figcaption></figure><figure id="e62674ce-38ca-4375-8942-4ead368f0517" class="image" style="text-align:left"><a href="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2014.png"><img style="width:542px" src="Parallel%20Wave%20Function%20Collapse%208eb6f4879dcb48b6881732c9a2a93683/Untitled%2014.png"/></a><figcaption>N = 6</figcaption></figure><p id="bafe8448-ccdd-4a39-b033-a21d1ee07441" class="">
</p></div></article></body></html>